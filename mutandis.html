<html>
  <body id=observe-scope>
  <script>
    var ELEMENT_NODE = 1;
    var MAX_ATTR = 99;
    var attribute_count = 0;
    // Select the node that will be observed for mutations
    var targetNode = document.getElementById('observe-scope');

    // Options for the observer (which mutations to observe)
    var config = { attributes: true, childList: true, subtree: true, attributeFilter:["src"] };

    // Callback function to execute when mutations are observed
    var callback = function(mutationsList) {
        for(var mutation of mutationsList) {
            // childList: nodes probably added
            if (mutation.type == 'childList') { 
                for(var child of mutation.addedNodes) {
                  if (child.nodeType === ELEMENT_NODE && child.hasAttribute("src")) {
                    var new_url = child.src + "/mutC";
                    var mutandis_src = document.createAttribute("mutandis_src");
                    mutandis_src.value=new_url;
                    child.setAttributeNode(mutandis_src);
                    child.setAttribute("src", new_url);
                  }
                }
            }
            // attributes: attributes modified -- only src due to attributeFilter above
            else if (mutation.type == 'attributes') {
              attribute_count = attribute_count + 1;
              var old_mutandis_src = mutation.target.getAttribute("mutandis_src");
              var old_src = mutation.target.getAttribute("src");
              // only modify changes that we didn't create, and don't change too many!
              if (old_src !== old_mutandis_src && MAX_ATTR > attribute_count) {
                  var new_url = old_src + "/mut"+attribute_count;
                  var mutandis_src = document.createAttribute("mutandis_src");
                  mutandis_src.value = new_url;
                  mutation.target.setAttributeNode(mutandis_src);
                  mutation.target.setAttribute("src", new_url);
              }
            }
        }
    };

    // Create an observer instance linked to the callback function
    var observer = new MutationObserver(callback);

    // Start observing the target node for configured mutations
    observer.observe(targetNode, config);

    //// Later, you can stop observing
    // observer.disconnect();
  </script>

    <img src="fake.jpg" id="target">

  <script>
    document.getElementById("target").src="done.jpg"
  </script>
  </body>
</html>

